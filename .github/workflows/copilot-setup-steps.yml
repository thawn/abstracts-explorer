name: "Copilot Setup Steps"

# Automatically run the setup steps when they are changed to allow for easy validation, and
# allow manual testing through the repository's "Actions" tab
on:
    workflow_dispatch:
    push:
        paths:
            - .github/workflows/copilot-setup-steps.yml
    pull_request:
        paths:
            - .github/workflows/copilot-setup-steps.yml

jobs:
    # The job MUST be called `copilot-setup-steps` or it will not be picked up by Copilot.
    copilot-setup-steps:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0 # Needed for hatch-vcs to determine version

            - name: Setup NeurIPS Abstracts Environment
              uses: ./.github/actions/setup-environment
              with:
                  python-version: "3.12"
                  install-node: "true"
                  uv-cache: "true"

            - name: Verify Python environment
              run: |
                  uv run python --version
                  uv run python -c "import neurips_abstracts; print(f'Package version: {neurips_abstracts.__version__}')"

            - name: Verify Node.js environment
              run: |
                  node --version
                  npm --version
                  npm list --depth=0

            - name: Run quick tests
              run: |
                  uv run pytest tests/test_cli.py::TestCLI::test_main_no_command

            - name: Run linting checks
              run: |
                  echo "Running linting checks..."
                  uv pip install --system ruff mypy types-requests
                  ruff check src/ tests/
                  mypy src/ --ignore-missing-imports

            - name: Environment setup summary
              if: always()
              run: |
                  echo "========================================="
                  echo "Environment Setup Summary"
                  echo "========================================="
                  echo "Python: $(python3 --version)"
                  echo "uv: $(uv --version)"
                  echo "Node.js: $(node --version)"
                  echo "npm: $(npm --version)"
                  echo "Virtual environment: $(.venv/bin/python --version)"
                  echo "========================================="
