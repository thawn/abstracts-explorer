#!/bin/bash
# Post-checkout hook to run npm install:vendor when HTML/JS files change

# Arguments:
# $1 = ref of previous HEAD
# $2 = ref of new HEAD
# $3 = flag (1 if branch checkout, 0 if file checkout)

PREV_HEAD=$1
NEW_HEAD=$2
BRANCH_CHECKOUT=$3

# Only run on branch checkout
if [ "$BRANCH_CHECKOUT" = "0" ]; then
    exit 0
fi

# Check if HTML or JS files changed
CHANGED_FILES=$(git diff --name-only $PREV_HEAD $NEW_HEAD -- \
    'src/abstracts_explorer/web_ui/templates/*.html' \
    'src/abstracts_explorer/web_ui/static/*.js' \
    'src/abstracts_explorer/web_ui/static/*.css' \
    'tailwind.config.js' \
    2>/dev/null)

if [ -n "$CHANGED_FILES" ]; then
    echo "Detected changes in web UI files:"
    echo "$CHANGED_FILES"
    echo "Running npm run install:vendor..."
    npm run install:vendor
fi
